<template>
    <div class="common-layout">
        <el-container>
            <el-header>
                <div>
                    <el-row :gutter="30">
                        <el-col :span="5">
                            <el-form-item label="姓名：">
                                <el-input
                                    v-model="queryParams.customerName"
                                    clearable
                                />
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="入住日期：">
                                <el-date-picker
                                    value-format="YYYY-MM-DD"
                                    format="YYYY/MM/DD"
                                    v-model="dateChange"
                                    type="daterange"
                                    start-placeholder="开始日期"
                                    end-placeholder="结束日期"
                                    range-separator="至"
                                />
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-button type="primary" color="#337ab7" icon="Search" @click="query">查询</el-button>
                        </el-col>
                    </el-row>
                </div>
            </el-header>
            <el-divider style="margin:0;"></el-divider>
            <el-main>
                <div>
                    <el-row class="mb-4">
                        <el-button :class="[{activeBtn:btnFlag}]" style="border:1px white solid;margin-left: 0px;">正在使用</el-button>
                        <el-button :class="[{activeBtn:!btnFlag}]" style="border:1px white solid;margin-left: 0px;">使用历史</el-button>
                    </el-row>
                </div>
                <div>
                    <!-- 表格 -->
                     <el-table :data="bedDetailsList" style="width: 100%;color:black;" >
                        <el-table-column align="center" type="index" :index="indexMethod"  label="序号" width="60"/>
                        <el-table-column align="center" prop="customerName"  label="客户姓名" width="120"/>
                        <el-table-column align="center" prop="customerSex"  label="性别" width="100">
                            <template #default="scope">
                               {{ scope.row.customerSex === 0 ? '男' : '女' }}
                            </template>
                        </el-table-column>
                        <el-table-column align="center" prop="bedDetails"  label="床位详情" width="120"/>
                        <el-table-column align="center" prop="startDate"  label="床位使用起始日期" width="150"/>
                        <el-table-column align="center" prop="endDate"  label="床位使用结束日期" width="150"/>
                        <el-table-column align="center" fixed="right" label="操作" width="220">
                            <template #default="scope">
                                <el-button type="warning" link icon="Switch" v-if="btnFlag" size="small" @click="exchange(scope.row)">床位调换</el-button>
                                <el-button type="primary" link icon="Edit" v-if="btnFlag" size="small">修改</el-button>
                                <el-button type="danger"  icon="Delete" v-if="!btnFlag" size="small">删除</el-button>
                                
                            </template>
                        </el-table-column>
                     </el-table>
                </div>
                <!-- 分页插件 -->
                 <div style="margin-top: 15px;">
                    <el-pagination background layout="prev, pager, next" :total="page.total" 
                    v-model="page.currentPage" v-model:page-size="page.pageSize"
                    @current-change="handleCurrentChange"/>
                 </div>
            </el-main>
        </el-container>
        <el-dialog v-model="exchangeData.dialogFormVisible" title="床位调换" width="60%" :before-close="exchangeClose"
         align-center draggable>
            <el-divider border-style="double" style="margin: 0;"></el-divider>
            <el-form :model="exchangeData.exchangeForm" label-position="right" label-width="auto" 
            style="max-width: 800px;margin: 20px auto;" class="demo-form-inline" :inline="true" ref="exchangeForm">
                <el-form-item label="客户姓名">
                    <el-input v-model="exchangeData.form.customerName" disabled />
                </el-form-item>
                <el-form-item label="床位详情">
                    <el-input v-model="exchangeData.form.bedDetails" disabled />
                </el-form-item>
                <el-form-item label="调换床位">
                    <el-select v-model="exchangeData.form.newBedDetails" placeholder="请选择新床位">
                        <el-option label="床位1" value="床位1"></el-option>
                        <el-option label="床位2" value="床位2"></el-option>
                        <el-option label="床位3" value="床位3"></el-option>
                    </el-select>
                </el-form-item>
            </el-form>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="exchangeData.dialogFormVisible = false">取 消</el-button>
                    <el-button type="primary" @click="exchangeData.dialogFormVisible = false">确 定</el-button>
                </span>
            </template>

        </el-dialog>
    </div>
</template>

<script setup>
import { listRoom } from '../../api/roomApi';
import { listBedDetails } from '../../api/bedapi';
import { computed, onMounted,ref } from 'vue';

let btnFlag = ref(true); //按钮状态
let page =ref({
    total: 0,
    pageSize: 6,
    currentPage: 1,
    pageCount: 0
})

//查询房间列表
const getRoomList =()=>{
    listRoom().then(res=>{
        console.log(res.data);
    })
}

let queryParams = ref({
    "currentPage": 1,
    "pageSize": 6,
    "customerName": "",
    "startDate": "",
    "endDate": "",
    "isDeleted": 0
 })
//查询床位详情信息-分页
let bedDetailsList = ref([]);
const findbedDetailsList = () => {
    listBedDetails(queryParams.value).then(res => {
        // console.log(res.data);
        bedDetailsList.value = res.data.records;
        page.value.total = res.data.total;
        page.value.pageCount = res.data.pages;
        page.value.currentPage = res.data.currentPage;
        page.value.pageSize = res.data.size;
    })
}

//序号计算
const indexMethod= computed(()=>{
    return page.value.currentPage*page.value.pageSize- page.value.pageSize + 1;
})

//查询
const dateChange = ref([]);//日期区间
const query=()=>{
    if(dateChange.value != null){
        //如果输入了日期
        queryParams.value.startDate = dateChange.value[0];
        queryParams.value.endDate = dateChange.value[1];
    }else{
        //如果没有输入日期
        queryParams.startDate = "";
        queryParams.endDate = "";
    }
    queryParams.currentPage = 1; //重置当前页为1
    //重载表格
    findbedDetailsList();
}


//分页查询操作
const handleCurrentChange =(curPage)=>{
    queryParams.value.currentPage = curPage;
    page.value.currentPage = curPage;
    //重新渲染表格
    findbedDetailsList();
}

//床位调换
let exchangeData = ref({
    dialogFormVisible: false,
   
})

//点击床位调换
const exchange = (row) =>{
    exchangeData.value.dialogFormVisible = true;

}
onMounted(()=>{
    // getRoomList();
    findbedDetailsList()
})
</script>

<style scoped>
.activeBtn{
    color:#1890ff;
    background-color: rgb(232, 244, 255);
}
</style>
































<template>
    <div class="common-layout">
        <el-container>
            <el-header>
                <div>
                    <el-row :gutter="30">
                        <el-col :span="5">
                            <el-form-item label="姓名：">
                                <el-input v-model="queryParams.customerName" clearable />
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="入住日期：">
                                <el-date-picker value-format="YYYY-MM-DD" format="YYYY/MM/DD" v-model="dateChange"
                                    type="daterange" start-placeholder="开始日期" end-placeholder="结束日期"
                                    range-separator="至" />
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-button type="primary" color="#337ab7" icon="search" @click="dateChange">查询</el-button>
                        </el-col>
                    </el-row>
                </div>
            </el-header>
            <el-divider style="margin: 0;"></el-divider>
            <el-main>
                <div>
                    <el-row class="mb-4">
                        <el-button :class="[{ activeBtn: btnFlag }]"
                            style="border:1px white solid;margin-left:0">正在使用</el-button>
                        <el-button :class="[{ activeBtn: !btnFlag }]"
                            style="border:1px white solid;margin-left:0">使用历史</el-button>
                    </el-row>
                </div>
                <div>
                    <!-- 表格 -->
                    <el-table :data="bedDetailsList" stripe style="width: 100%;color:black">
                        <el-table-column align="center" type="index" :index="indexMethod" label="序号" width="60" />
                        <el-table-column align="center" prop="customerName" label="客户姓名" width="120" />
                        <el-table-column align="center" prop="customerSex" label="性别" width="100">
                            <template #default="scope">{{ scope.row.customerSex == 0 ?
                                '男' : '女' }}</template></el-table-column>
                        <el-table-column align="center" prop="bedDetails" label="床位信息" width="140" />
                        <el-table-column align="center" prop="startDate" label="开始日期" width="150" />
                        <el-table-column align="center" prop="endDate" label="结束日期" width="150" />
                        <el-table-column align="center" fixed="right" label="操作" width="220">
                            <template #default="scope">
                                <el-button type="warning" link icon="Switch" v-if="btnFlag" size="small"
                                    @click="exchange(scope.row)">床位调换</el-button>
                                <el-button type="primary" link icon="Edit" v-if="btnFlag" size="small">修改</el-button>
                                <el-button type="danger" link icon="Delete" v-if="!btnFlag" size="small">删除</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </div>
                <!-- 分页插件 -->
                <div style="margin-top: 15px;">
                    <el-pagination background layout="prev, pager, next" :total="page.total"
                        v-model:current-page="page.currentPage" v-model:page-size="page.pageSize"
                        @current-change="handleCurrentChange" />
                </div>
            </el-main>
        </el-container>
        <!-- 床位调换对话框 -->
        <el-dialog v-model="exchangeDate.dialogFormVisible" title="床位调换" width="60%" :before-close="exchangeClose"
            align-center draggable>
            <el-divider border-style="double" style="margin:0;"></el-divider>
            <el-form :model="exchangeDate.exchangeForm" label-position="right" label-width="auto"
                style="max-width:800px; margin: 20px auto;" class="demo-form-inline" :inline="true" ref="exchangeForm">
                <el-form-item label="Promotion name" :label-width="formLabelWidth">
                    <el-input v-model="form.name" autocomplete="off" />
                </el-form-item>
                <el-form-item label="Zones" :label-width="formLabelWidth">
                    <el-select v-model="form.region" placeholder="Please select a zone">
                        <el-option label="Zone No.1" value="shanghai" />
                        <el-option label="Zone No.2" value="beijing" />
                    </el-select>
                </el-form-item>
            </el-form>
            <template #footer>
                <div class="dialog-footer">
                    <el-button @click="dialogFormVisible = false">Cancel</el-button>
                    <el-button type="primary" @click="dialogFormVisible = false">
                        Confirm
                    </el-button>
                </div>
            </template>
        </el-dialog>
    </div>
</template>



    <script setup>
    import { listRoom } from '../../api/roomApi';
    import { computed, onMounted, ref } from 'vue';
    import { listBeddetails } from '../../api/bedApi';

    let btnFlag = ref(true)

    let page = ref({
        total: 0,
        pageSize: 6,
        currentPage: 1,
        pageCount: 0
    })

    //查询房间列表
    const getRoomList = () => {
        listRoom().then((res) => {
            console.log(res.data);
        })
    }
    let queryParams = ref({
        "currentPage": 1,
        "pageSize": 6,
        "customerName": "",
        "startDate": "",
        "endDate": "",
        "isDeleted": 0
    })


    //查询床位详情-分页
    let bedDetailsList = ref([]);
    const findbedDetailsList = () => {
        listBeddetails(queryParams.value).then((res) => {
            bedDetailsList.value = res.data.records;
            page.value.total = res.data.total;
            page.value.pageCount = res.data.pages;
            page.value.currentPage = res.data.currentPage;
            page.value.pageSize = res.data.size;
        })
    }
    const handleCurrentChange = (curPage) => {
        queryParams.value.currentPage = curPage;
        page.value.currentPage = curPage;
        //重新渲染表格
        findbedDetailsList();
    }

    //序号计算
    const indexMethod = computed(() => {
        return page.value.currentPage * page.value.pageSize - page.value.pageSize + 1;
    })



    //查询
    let dateChange = ref([])//日期区间
    const query = () => {
        if (dateChange.value != null) {
            queryParams.value.startDate = dateChange.value[0];
            queryParams.value.endDate = dateChange.value[1];
        } else {
            queryParams.startDate = "";
            queryParams.endDate = "";
        }
        queryParams.currentPage = 1;//重置当前页为1
        //重载表格
        findbedDetailsList();
    }

    //床位调换对话框
    let exchangeDate = ref({
        dialogFormVisible: false
    })

    //点击床位调换
    const exchange = (row) => {
        exchangeDate.value.dialogFormVisible = true;
    }

    onMounted(() => {
        //   getRoomList();
        findbedDetailsList()
    });
</script>

    <style scoped>
    .activeBtn {
        color: #1890ff;
        background-color: rgb(232, 244, 255)
    }
</style>


   <!-- <el-dialog v-model="exchangeDate.dialogFormVisible" title="床位调换" width="60%" :before-close="exchangeClose"
         align-center draggable>
            <el-divider border-style="double" style="margin: 0;"></el-divider>
            <el-form :model="exchangeDate.exchangeForm" label-position="right" label-width="auto" 
            style="max-width: 800px;margin: 20px auto;" class="demo-form-inline" :inline="true" ref="exchangeForm">
                <el-form-item label="客户姓名" prop="customerName">
                    <el-input readonly v-model="exchangeDate.exchangeForm.customerName"  />
                </el-form-item>
                <el-form-item label="旧床位详情" prop="bedDetails">
                    <el-input readonly v-model="exchangeDate.exchangeForm.bedDetails"  />
                </el-form-item>
                <el-form-item label="性别" prop="customerSex">
                    <el-input readonly v-model="exchangeDate.exchangeForm.customerSex"
                     :value="exchangeDate.exchangeForm.customerSex==0 ? '男' : '女'"/>
                </el-form-item>
                <el-form-item label="新楼号" prop="buildingId">
                    <el-input readonly v-model="exchangeDate.exchangeForm.buildingId"  />
                </el-form-item>
                <el-form-item label="新房号" prop="newRoomNo">
                    <el-select v-model="exchangeDate.exchangeForm.newRoomNo" placeholder="请选择房间号"style="width: 200px;"
                    @change="getBed">
                   <el-option-group v-for="group in exchangeDate.roomList" :key="group.label" :label="group.label">
                    <el-option v-for="item in group.options" :key="item.roomNo" :label="item.roomNo" 
                     :value="item.roomNo">
                    </el-option>
                    </el-option-group>
                </el-select>
                    <el-input readonly v-model="exchangeDate.exchangeForm.newRoomNo"  />
            
                </el-form-item>
                  <el-form-item label="当前床位使用起始日期" prop="startDate">
                    <el-input readonly v-model="exchangeDate.exchangeForm.startDate"  />
                </el-form-item>
                <el-form-item label="新床号" prop="newBwdId">
                    <el-select v-model="exchangeDate.exchangeForm.newBedId" placeholder="请选择房间号"style="width: 200px;"
                    @change="getBed">
                </el-select>
                    <el-input readonly v-model="exchangeDate.exchangeForm.newRoomNo"  />
                </el-form-item>
                <el-form-item label="当前床位结束起始日期" prop="endDate">
                    <el-input readonly v-model="exchangeDate.exchangeForm.endDate"  />
                </el-form-item>
            </el-form>
            <el-divider border-style="double" style="margin: 0;"></el-divider>
            <template #footer>
                <span class="dialog-footer" style="margin-top: 0px;">
                    <el-button @click="exchangeSave">保 存</el-button>
                    <el-button type="primary" @click="exchangeCancle">取 消</el-button>
                </span>
            </template>

        </el-dialog> -->
       



<template>
    <div class="common-layout">
        <el-container>
            <el-header>
                <div>
                    <el-row :gutter="30">
                        <el-col :span="5">
                            <el-form-item label="姓名：">
                                <el-input
                                    v-model="queryParams.customerName"
                                    clearable
                                />
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="入住日期：">
                                <el-date-picker
                                    value-format="YYYY-MM-DD"
                                    format="YYYY/MM/DD"
                                    v-model="dateChange"
                                    type="daterange"
                                    start-placeholder="开始日期"
                                    end-placeholder="结束日期"
                                    range-separator="至"
                                />
                            </el-form-item>
                        </el-col>
                        <el-col :span="6">
                            <el-button type="primary" color="#337ab7" icon="Search" @click="query">查询</el-button>
                        </el-col>
                    </el-row>
                </div>
            </el-header>
            <el-divider style="margin:0;"></el-divider>
            <el-main>
                <div>
                    <el-row class="mb-4">
                        <el-button :class="[{activeBtn:btnFlag}]" style="border:1px white solid;margin-left: 0px;">正在使用</el-button>
                        <el-button :class="[{activeBtn:!btnFlag}]" style="border:1px white solid;margin-left: 0px;">使用历史</el-button>
                    </el-row>
                </div>
                <div>
                    <!-- 表格 -->
                     <el-table :data="bedDetailsList" style="width: 100%;color:black;" >
                        <el-table-column align="center" type="index" :index="indexMethod"  label="序号" width="60"/>
                        <el-table-column align="center" prop="customerName"  label="客户姓名" width="120"/>
                        <el-table-column align="center" prop="customerSex"  label="性别" width="100">
                            <template #default="scope">
                               {{ scope.row.customerSex === 0 ? '男' : '女' }}
                            </template>
                        </el-table-column>
                        <el-table-column align="center" prop="bedDetails"  label="床位详情" width="120"/>
                        <el-table-column align="center" prop="startDate"  label="床位使用起始日期" width="150"/>
                        <el-table-column align="center" prop="endDate"  label="床位使用结束日期" width="150"/>
                        <el-table-column align="center" fixed="right" label="操作" width="220">
                            <template #default="scope">
                                <el-button type="warning" link icon="Switch" v-if="btnFlag" size="small" @click="exchange(scope.row)">床位调换</el-button>
                                <el-button type="primary" link icon="Edit" v-if="btnFlag" size="small">修改</el-button>
                                <el-button type="danger"  icon="Delete" v-if="!btnFlag" size="small">删除</el-button>
                                
                            </template>
                        </el-table-column>
                     </el-table>
                </div>
                <!-- 分页插件 -->
                 <div style="margin-top: 15px;">
                    <el-pagination background layout="prev, pager, next" :total="page.total" 
                    v-model="page.currentPage" v-model:page-size="page.pageSize"
                    @current-change="handleCurrentChange"/>
                 </div>
            </el-main>
        </el-container>
      <el-dialog
  v-model="exchangeDate.dialogFormVisible"
  title="床位调换"
  width="60%"
  :before-close="exchangeClose"
  align-center
  draggable
>
  <el-divider border-style="double" style="margin: 0;"></el-divider>
<el-form
        :model="exchangeDate.exchangeForm"
         label-position="right"
         label-width="auto"
         :inline="true"
         style="margin: 20px auto;"
         ref="exchangeForm"
>
  <el-form-item label="客户姓名" prop="customerName">
    <el-input readonly v-model="exchangeDate.exchangeForm.customerName" />
  </el-form-item>

  <el-form-item label="旧床位详情" prop="bedDetails">
    <el-input readonly v-model="exchangeDate.exchangeForm.bedDetails" />
  </el-form-item>

  <el-form-item label="性别" prop="customerSex">
    <el-input
      readonly
      :value="exchangeDate.exchangeForm.customerSex == 0 ? '男' : '女'"
    />
  </el-form-item>

  <el-form-item label="新楼号" prop="buildingId">
    <el-input readonly v-model="exchangeDate.exchangeForm.buildingId" />
  </el-form-item>

  <el-form-item label="新房号" prop="newRoomNo">
    <el-select
      v-model="exchangeDate.exchangeForm.newRoomNo"
      placeholder="请选择房间号"
      style="width: 200px;"
      @change="getBed"
    >
      <el-option-group
        v-for="group in exchangeDate.roomList"
        :key="group.label"
        :label="group.label"
      >
        <el-option
          v-for="item in group.options"
          :key="item.roomNo"
          :label="item.roomNo"
          :value="item.roomNo"
        />
      </el-option-group>
    </el-select>
  </el-form-item>

  <el-form-item label="当前床位使用起始日期" prop="startDate">
    <el-input readonly v-model="exchangeDate.exchangeForm.startDate" />
  </el-form-item>

  <el-form-item label="新床号" prop="newBedId">
    <el-select
      v-model="exchangeDate.exchangeForm.newBedId"
      placeholder="请选择床位"
      style="width: 200px;"
    />
  </el-form-item>

  <el-form-item label="当前床位使用结束日期" prop="endDate">
    <el-input readonly v-model="exchangeDate.exchangeForm.endDate" />
  </el-form-item>
</el-form>

  <el-divider border-style="double" style="margin: 0;"></el-divider>

  <template #footer>
    <span class="dialog-footer" style="margin-top: 0px;">
      <el-button @click="exchangeSave">保 存</el-button>
      <el-button type="primary" @click="exchangeCancle">取 消</el-button>
    </span>
  </template>
</el-dialog>

    </div>
</template>

<script setup>
import { listRoom } from '../../api/roomApi';
import { listBeddetails } from '../../api/bedApi';
import { computed, nextTick, onMounted,ref } from 'vue';

let btnFlag = ref(true); //按钮状态
let page =ref({
    total: 0,
    pageSize: 6,
    currentPage: 1,
    pageCount: 0
})

//查询房间列表
const getRoomList =()=>{
    listRoom().then(res=>{
        //构建房间列表数据
        let floor1=res.data.filter((item,i,arr)=>{
            return item.roomFloor=="一楼"
        })
        let floor2=res.data.filter((item,i,arr)=>{
            return item.roomFloor=="二楼"
        })
        exchangeDate.value.roomList=[
            {label:"一楼",option:floor1},
             {label:"二楼",option:floor2}
        ]
    })
}

let queryParams = ref({
    "currentPage": 1,
    "pageSize": 6,
    "customerName": "",
    "startDate": "",
    "endDate": "",
    "isDeleted": 0
 })
//查询床位详情信息-分页
let bedDetailsList = ref([]);
const findbedDetailsList = () => {
    listBeddetails(queryParams.value).then(res => {
        // console.log(res.data);
        bedDetailsList.value = res.data.records;
        page.value.total = res.data.total;
        page.value.pageCount = res.data.pages;
        page.value.currentPage = res.data.currentPage;
        page.value.pageSize = res.data.size;
    })
}

//序号计算
const indexMethod= computed(()=>{
    return page.value.currentPage*page.value.pageSize- page.value.pageSize + 1;
})

//查询
const dateChange = ref([]);//日期区间
const query=()=>{
    if(dateChange.value != null){
        //如果输入了日期
        queryParams.value.startDate = dateChange.value[0];
        queryParams.value.endDate = dateChange.value[1];
    }else{
        //如果没有输入日期
        queryParams.value.startDate = "";
        queryParams.value.endDate = "";
    }
    queryParams.currentPage = 1; //重置当前页为1
    //重载表格
    findbedDetailsList();
}


//分页查询操作
const handleCurrentChange =(curPage)=>{
    queryParams.value.currentPage = curPage;
    page.value.currentPage = curPage;
    //重新渲染表格
    findbedDetailsList();
}

//床位调换
let exchangeDate = ref({
    dialogFormVisible: false,
    exchangeForm:{
        customerName:"",
        customerSex:"",
        bedDetails:"",
        startDate:"",
        id:"",
        customerId:"",
        buildingId:606,
        oldBedId:"",
        newRoomNo:"",
        newBedId:"",
        oldRoomNo:"",
        endDate:"",
    },
    roomList:[],
    bedList:[]
})

//点击床位调换
const exchange = (row) =>{
    exchangeDate.value.dialogFormVisible = true;
    //初始化菜单
    nextTick(()=>{
        exchangeDate.value.exchangeForm.customerName = row.customerName;
        exchangeDate.value.exchangeForm.customerSex = row.customerSex;
        exchangeDate.value.exchangeForm.bedDetails = row.bedDetails;
        exchangeDate.value.exchangeForm.startDate = row.startDate;
        exchangeDate.value.exchangeForm.id = row.id;
        exchangeDate.value.exchangeForm.customerId = row.customerId;
        exchangeDate.value.exchangeForm.buildingId = row.buildingId; // 默认值
        exchangeDate.value.exchangeForm.oldBedId = row.oldBedId;
        exchangeDate.value.exchangeForm.oldRoomNo = row.oldRoomNo;
        exchangeDate.value.exchangeForm.endDate = row.endDate;
        
        // 清空新床位相关字段（避免沿用之前的数据）
        exchangeDate.value.exchangeForm.newRoomNo = '';
        exchangeDate.value.exchangeForm.newBedId = '';
    
    })
    getRoomList();
} 

//根据选择的房间号查询床位
const getBed=()=>{


}

onMounted(()=>{
    // getRoomList();
    findbedDetailsList()
})
</script>

<style scoped>
.activeBtn{
    color:#1890ff;
    background-color: rgb(232, 244, 255);
}
</style>




